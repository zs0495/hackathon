<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>bokbok_mypage</title>
    <link rel="stylesheet" href="style.css" />
    <style>

    /* 1. 뒤로 가기 버튼 및 로고 */
    .fixed-top-left {
        position: fixed; /* 뷰포트 기준으로 위치 고정 */
        top: 25px;       /* 상단에서 25px */
        left: 25px;      /* 좌측에서 25px */
        z-index: 100;    /* 다른 요소 위에 보이도록 */
    }

    .back-btn {
        background: none;
        border: none;
        font-size: 36px;
        color: #333;
        cursor: pointer;
        text-decoration: none;
        font-weight: 600;
        /* font-size: px; 오타 수정 */
        line-height: 1;
    }

      .login-logo {
        position: fixed;  /* 스크롤해도 유지됨 */
        top: 25px;       
        left: 50%;
        transform: translateX(-50%); /* 정확한 가로 중앙 정렬 */
        width: 160px;     /* 로고 크기 */
        height: auto;
        z-index: 200; 
    }

    /* 2. 페이지 제목 */
    .mypage-page {
      margin: 53px 0 40px; 
      padding: 30px 0 40px;
      box-sizing: border-box;
    }
    
    .mypage-header {
      background: #f5f9ff; 
      border: 1px solid #ddd;
      padding: 30px 0;      
      text-align: center;
      border-left: 0;          
      border-right: 0;
    }

    .mypage-header h2 {
      font-size: 26px;
      font-weight: 700;
      margin: 0;
    }

    .mypage-container {
      max-width: 960px;
      margin: 30px auto 30px;
      padding: 0 24px;
    }

    /* 3. 개인정보영역 */
    .info-box {
      padding: 16px 20px 10px;
    }

    .info-box .row {
      display: flex;
      gap: 150px;
      margin-bottom: 19px;
      font-size: 16px;
    }

    .info-box .label {
    width: 70px;
    flex-shrink: 0;
    }

    .info-box .value {
    flex: 1;
    color: #222222;
    }

    .info-box .long-text {
    line-height: 1.5;
    }

    /* 4. 찜한 복지 영역  */
    .fav-list {
    width: 100%;
    padding: 16px 20px 10px;
    margin-top: 8px;
    }

    .fav-row {
    display: table;
    width: 100%;
    table-layout: fixed;
    }

    .fav-row:last-child .fav-cell {
    border-bottom: none;
    }

    .fav-title-cell {
    display: table-cell;
    width: 26%;
    padding: 10px 0;
    vertical-align: middle;
    font-size: 16px;
    }

    .fav-cell {
    display: table-cell;
    width: 27%;
    padding: 10px 0;
    vertical-align: middle;
    font-size: 16px;
    border-bottom: 1px solid #eee;
    }

    .fav-heart {
    display: table-cell;
    width: 20%;
    padding: 10px 0;
    text-align: right;
    vertical-align: middle;
    font-size: 18px;
    }

    .fav-heart::before {
    content: "♥";
    color: #7ca2e0;
    }

    .fav-heart:not(.liked)::before {
    content: "♡";
    color: #7ca2e0;
    }

    /* 5. 수정 완료 버튼  */
    .mypage-page .login-btn {
    display: block;
    width: 70%;
    margin: 80px auto 0;
    padding: 12px 0;
    border: none;
    border-radius: 6px;
    background-color: #111111;
    color: #ffffff;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    }

    </style>
</head>
<body>

    <div class="top-bar">
        <a href="index.html" class="back-btn fixed-top-left">‹</a>
        <a href="index.html">
            <img src="../images/bokbok_logo.png" alt="로고" class="login-logo">
        </a>
    </div>
    
    <main class="mypage-page">
    <section class="mypage-header">
        <h2>마이페이지</h2>
    </section>

    <section class="mypage-container">
    <section class="info-box">
        <div class="row">
        <span class="label">이름</span>
        <span class="value editable" data-field="name">김복복</span>
        </div>

        <div class="row">
        <span class="label">생년월일</span>
        <span class="value editable" data-field="birth">2002년 6월 2일</span>
        </div>

        <div class="row">
        <span class="label">주소</span>
        <span class="value editable" data-field="address">서울특별시 구로구</span>
        </div>

        <div class="row">
        <span class="label">현재 상황</span>
        <span class="value long-text editable" data-field="status">
            자취를 하고 있는데 이번달 월세를 낼 수가 없어요..  
            알바는 하고 있지만 생활비로 다 나가고 있고 
            부모님과 연락은 안하고 있는 상황이라 돈 빌릴 곳도 없어요
        </span>
        </div>
    </section>

    <hr />

    <section class="fav-list">
    <div class="fav-row">
        <div class="fav-title-cell">찜한 복지</div>
        <!-- 예시 데이터 (나중에 백엔드 연결하면 삭제) -->
        <div class="fav-cell">서울시청</div>
        <div class="fav-cell">청년 월세 지원</div>
        <div class="fav-heart"></div>
    </div>

    <div class="fav-row">
        <div class="fav-title-cell"></div>
        <div class="fav-cell">보건복지부</div>
        <div class="fav-cell">긴급 복지 지원</div>
        <div class="fav-heart"></div>
    </div>

    <div class="fav-row">
        <div class="fav-title-cell"></div>
        <div class="fav-cell">고용노동부</div>
        <div class="fav-cell">청년 구직 활동 지원금</div>
        <div class="fav-heart"></div>
    </div>
    </section>

    <button class="login-btn">수정 완료</button>
    </section>

    </main>

  <footer class="footer">
    © 2025 bokbok. All rights reserved.
  </footer>
  
  <script src="auth.js"></script>
  <script>
    
    document.addEventListener('DOMContentLoaded', () => {
      const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
      const STORAGE_KEY = 'bokbok_mypage';
      let mypageState = {
        profile: {
          name: '',
          birth: '',
          address: '',
          status: ''
        }, favorites: [] 
      };
      const fieldLabels = {
        name: '이름',
        birth: '생년월일',
        address: '주소',
        status: '현재 상황'
      };

      // 로그인해야 접근 가능
      if (!isLoggedIn) {
        alert('로그인이 필요한 서비스입니다.');
        location.href = 'login.html';
        return;
      }
      
      // 저장된 페이지 불러오기
      const saved = loadFromStorage();
      if (saved) {
        mypageState = saved; 
      } 
      else {
        mypageState = initStateFromDOM(); 
      }

      applyStateToDOM(); // 현재 값들을 화면에 반영
      initEditableProfile(); // 프로필 수정
      initFavoriteHearts(); // 찜 하트
      initSaveButton(); // 수정 완료 버튼

      // 데이터 객체로 반환
      function loadFromStorage() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return null;
          return JSON.parse(raw);
        } catch (e) {
          console.error('load error', e);
          return null;
        }
      }

      // 프로필, 찜 불러오기
      function initStateFromDOM() {
        const profile = {
          name: getText('[data-field="name"]'),
          birth: getText('[data-field="birth"]'),
          address: getText('[data-field="address"]'),
          status: getText('[data-field="status"]')
        };

        const favorites = [];
        const rows = document.querySelectorAll('.fav-row');
        rows.forEach((row, index) => {
          const cells = row.querySelectorAll('.fav-cell');
          if (cells.length < 2) return;
          const org = cells[0].textContent.trim();
          const benefit = cells[1].textContent.trim();
          const liked = true;

          favorites.push({ org, benefit, liked });
          row.dataset.index = index;

          const heart = row.querySelector('.fav-heart');
          if (heart) {
            heart.classList.add('liked');
          }
        });

        return { profile, favorites };
      }

      // 화면에 적용
      function applyStateToDOM() {
        const p = mypageState.profile;
        setText('[data-field="name"]', p.name);
        setText('[data-field="birth"]', p.birth);
        setText('[data-field="address"]', p.address);
        setText('[data-field="status"]', p.status);

        const rows = document.querySelectorAll('.fav-row');
        rows.forEach((row, index) => {
          const fav = mypageState.favorites[index];
          if (!fav) return;

          const cells = row.querySelectorAll('.fav-cell');
          if (cells[0]) cells[0].textContent = fav.org;
          if (cells[1]) cells[1].textContent = fav.benefit;

          const heart = row.querySelector('.fav-heart');
          if (heart) {
            heart.classList.toggle('liked', fav.liked);
          }

          row.dataset.index = index;
        });
      }

      function getText(selector) {
        const el = document.querySelector(selector);
        return el ? el.textContent.trim() : '';
      }

      function setText(selector, value) {
        const el = document.querySelector(selector);
        if (el) el.textContent = value ?? '';
      }

      // 프로필 수정
      function initEditableProfile() {
        document.querySelectorAll('.info-box .editable').forEach((el) => {
          el.style.cursor = 'pointer';

          el.addEventListener('click', () => {
            const field = el.dataset.field; 
            const label = fieldLabels[field];
            const current = el.textContent.trim();
            const next = prompt(`${label}을(를) 입력하세요`, current);

            if (next !== null) {
              const trimmed = next.trim();
              el.textContent = trimmed;

              if (mypageState.profile[field] !== undefined) {
                mypageState.profile[field] = trimmed;
              }
            }
          });
        });
      }

      // 찜 하트 키고 끄기
      function initFavoriteHearts() {
        const rows = document.querySelectorAll('.fav-row');

        rows.forEach((row, index) => {
          row.dataset.index = index;
          const heart = row.querySelector('.fav-heart');
          if (!heart) return;

          heart.style.cursor = 'pointer';

          heart.addEventListener('click', () => {
            const idx = parseInt(row.dataset.index, 10);
            const fav = mypageState.favorites[idx];
            if (!fav) return;

            fav.liked = !fav.liked;
            heart.classList.toggle('liked', fav.liked);
          });
        });
      }

      // 수정 완료 버튼
      function initSaveButton() {
        const btn = document.querySelector('.login-btn');
        if (!btn) return;

        btn.addEventListener('click', (e) => {
          e.preventDefault(); 
          const rows = document.querySelectorAll('.fav-row');
          rows.forEach((row, idx) => {
            const fav = mypageState.favorites[idx];
            if (fav && !fav.liked) {
              row.remove();
            }
          });

          localStorage.setItem(STORAGE_KEY, JSON.stringify(mypageState));
          alert("마이페이지 정보가 저장되었어요.");
        });
      }
    });

  </script>
  
</body>
</html>