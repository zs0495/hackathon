<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì…</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { 
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', Arial, sans-serif; 
            padding: 20px; 
            background-color: #f4f7f6;
            color: #333;
        }
        .signup-container { 
            max-width: 600px; 
            margin: 40px auto; 
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h2 { 
            text-align: center; 
            color: #007bff;
            margin-bottom: 30px;
        }
        
        /* ë‹¨ê³„ ì¸ë””ì¼€ì´í„° ìŠ¤íƒ€ì¼ */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            padding: 0 10px;
        }
        .indicator-item { 
            flex-grow: 1;
            text-align: center;
            padding: 8px;
            color: #aaa; 
            border-bottom: 3px solid #eee;
            transition: all 0.3s;
        }
        .indicator-item.active { 
            font-weight: bold; 
            color: #007bff; 
            border-bottom: 3px solid #007bff;
        }
        
        /* ë‹¨ê³„ ì»¨í…ì¸  ìŠ¤íƒ€ì¼ */
        .step-content { 
            display: none; 
            padding: 20px 0; 
            border-top: 1px solid #eee;
        }
        .step-content.active { 
            display: block; 
        }
        h3 {
            color: #555;
            border-left: 5px solid #007bff;
            padding-left: 10px;
            margin-bottom: 20px;
        }
        
        /* í¼ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        .form-group { 
            margin-bottom: 20px; 
        }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #555;
        }
        input[type="text"], 
        input[type="password"], 
        input[type="number"], 
        select, 
        textarea { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; 
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #007bff;
            outline: none;
        }
        
        /* ì•½ê´€ ë™ì˜ ê·¸ë£¹ */
        .form-group input[type="checkbox"] + label {
            display: inline;
            font-weight: normal;
        }
        .form-group input[type="checkbox"] {
            margin-right: 8px;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #nextButton {
            width: 100%;
            padding: 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 20px;
        }
        #nextButton:hover {
            background-color: #0056b3;
        }

        /* ë©”ì‹œì§€/ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
        .alert { 
            padding: 15px; 
            background-color: #ffdddd; 
            color: #d8000c; 
            border: 1px solid #d8000c;
            border-radius: 4px;
            margin-bottom: 20px; 
            text-align: center; 
        }
        .success-message { 
            text-align: center; 
            padding: 50px; 
            background-color: #e6ffe6;
            border: 1px solid #4CAF50; 
            border-radius: 4px;
            color: #4CAF50;
        }
    </style>
</head>
<body>

<div class="signup-container">
    <h2>íšŒì›ê°€ì…</h2>

    {% if message and message != 'ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' %}
        <div class="alert">{{ message }}</div>
    {% endif %}
    
    <div class="step-indicator">
        <span id="step1Indicator" class="indicator-item active">1. ì•½ê´€ë™ì˜</span>
        <span id="step2Indicator" class="indicator-item">2. ì •ë³´ì…ë ¥</span>
        <span id="step3Indicator" class="indicator-item">3. ê°€ì…ì™„ë£Œ</span>
    </div>

    <form id="signupForm" action="{{ url_for('signup') }}" method="POST">
        
        <div id="step1" class="step-content active">
            <h3>1ë‹¨ê³„: ì•½ê´€ ë™ì˜</h3>
            
            <div class="form-group">
                <input type="checkbox" id="agreeAll"> <label for="agreeAll">ì „ì²´ ì•½ê´€ ë™ì˜</label>
            </div>
            
            <hr>
            
            <div class="form-group">
                <input type="checkbox" id="agreeRequired1" class="required-agree"> <label for="agreeRequired1">(í•„ìˆ˜) ì´ìš© ì•½ê´€ ë™ì˜</label>
                <p style="font-size: 0.8em; color: gray;">ì´ìš© ëª©ì , ë‚´ìš©, ì±…ì„ì˜ í•œê³„ ë“±ì— ê´€í•œ ì‚¬í•­</p>
            </div>
            
            <div class="form-group">
                <input type="checkbox" id="agreeRequired2" class="required-agree"> <label for="agreeRequired2">(í•„ìˆ˜) ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</label>
                <p style="font-size: 0.8em; color: gray;">ìˆ˜ì§‘ í•­ëª©, ìˆ˜ì§‘ ëª©ì , ë³´ìœ  ë° ì´ìš© ê¸°ê°„ ë“±ì— ê´€í•œ ì‚¬í•­</p>
            </div>
            
            <div class="form-group">
                <input type="checkbox" id="agreeOptional1"> <label for="agreeOptional1">(ì„ íƒ) ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜</label>
            </div>
        </div>

        <div id="step2" class="step-content">
            <h3>2ë‹¨ê³„: ê¸°ë³¸ ì •ë³´ ì…ë ¥</h3>
            
            <div class="form-group">
                <label for="username">ì•„ì´ë”” (ID)</label>
                <input type="text" id="username" name="username" pattern="[a-zA-Z0-9]{5,}" title="5ì ì´ìƒì˜ ì˜ë¬¸, ìˆ«ì ì¡°í•©" required>
            </div>
            
            <div class="form-group">
                <label for="password">ë¹„ë°€ë²ˆí˜¸ (8ì ì´ìƒ)</label>
                <input type="password" id="password" name="password" minlength="8" required>
            </div>
            
            <div class="form-group">
                <label for="passwordConfirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                <input type="password" id="passwordConfirm" required>
            </div>

            <div class="form-group">
                <label for="name">ì´ë¦„</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-group">
                <label for="phone">ì—°ë½ì²˜ (ì„ íƒ)</label>
                <input type="text" id="phone" name="phone" placeholder="'-' ì—†ì´ ì…ë ¥">
            </div>

        </div>

        <div id="step2_2" class="step-content">
            <h3>2-2ë‹¨ê³„: ì¶”ê°€ ì •ë³´ ì…ë ¥</h3>

            <div class="form-group">
                <label>ìƒë…„ì›”</label>
                <input type="number" id="birth_year" name="birth_year" placeholder="ì¶œìƒ ì—°ë„ (ì˜ˆ: 1990)" min="1900" max="{{ today_year | default(2025) }}" required>
                <input type="number" id="birth_month" name="birth_month" placeholder="ì¶œìƒ ì›” (ì˜ˆ: 1)" min="1" max="12" required>
            </div>

            <div class="form-group">
                <label for="city">ê±°ì£¼ì§€ (ì‹œ/ë„)</label>
                <select id="city" name="city" required>
                    <option value="" disabled selected>ì‹œ/ë„ ì„ íƒ</option>
                    <option value="ì„œìš¸">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                    <option value="ë¶€ì‚°">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                    <option value="ëŒ€êµ¬">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                    <option value="ì¸ì²œ">ì¸ì²œê´‘ì—­ì‹œ</option>
                    <option value="ê´‘ì£¼">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                    <option value="ëŒ€ì „">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                    <option value="ìš¸ì‚°">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                    <option value="ì„¸ì¢…">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                    <option value="ê²½ê¸°">ê²½ê¸°ë„</option>
                    <option value="ê°•ì›">ê°•ì›ë„</option>
                    <option value="ì¶©ë¶">ì¶©ì²­ë¶ë„</option>
                    <option value="ì¶©ë‚¨">ì¶©ì²­ë‚¨ë„</option>
                    <option value="ì „ë¶">ì „ë¼ë¶ë„</option>
                    <option value="ì „ë‚¨">ì „ë¼ë‚¨ë„</option>
                    <option value="ê²½ë¶">ê²½ìƒë¶ë„</option>
                    <option value="ê²½ë‚¨">ê²½ìƒë‚¨ë„</option>
                    <option value="ì œì£¼">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="district">ê±°ì£¼ì§€ (êµ¬/êµ°/ì‹œ)</label>
                <input type="text" id="district" name="district" placeholder="ê±°ì£¼í•˜ì‹œëŠ” êµ¬/êµ°/ì‹œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê°•ë‚¨êµ¬)" required>
            </div>

            <div class="form-group">
                <label for="situation">ê°€êµ¬ ìƒí™© (ì„ íƒ)</label>
                <textarea id="situation" name="situation" rows="3" placeholder="ì˜ˆ: í•œë¶€ëª¨ ê°€ì •, ì¥ì• ê°€êµ¬, ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì ë“± í•´ë‹¹í•˜ëŠ” ìƒí™©ì„ ê°„ëµíˆ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì„ íƒì‚¬í•­)"></textarea>
            </div>
        </div>
        
        <div id="step3" class="step-content">
            <h3>3ë‹¨ê³„: íšŒì›ê°€ì… ì™„ë£Œ ğŸ‰</h3>
            <div class="success-message">
                <p>íšŒì›ê°€ì…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                <p>ì´ì œ ë¡œê·¸ì¸í•˜ê³  ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ ë³´ì„¸ìš”.</p>
            </div>
        </div>

        <button type="button" id="nextButton">ë‹¤ìŒ</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const nextButton = document.getElementById('nextButton');
        const signupForm = document.getElementById('signupForm');
        
        // ë‹¨ê³„ ì»¨í…ì¸ 
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step2_2 = document.getElementById('step2_2');
        const step3 = document.getElementById('step3');

        // ë‹¨ê³„ ì¸ë””ì¼€ì´í„°
        const step1Indicator = document.getElementById('step1Indicator');
        const step2Indicator = document.getElementById('step2Indicator');
        const step3Indicator = document.getElementById('step3Indicator');
        
        // 1ë‹¨ê³„ ì•½ê´€ ê´€ë ¨
        const requiredAgrees = document.querySelectorAll('.required-agree');
        const agreeAll = document.getElementById('agreeAll');

        // 2ë‹¨ê³„ ì…ë ¥ í•„ë“œ
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const passwordConfirmInput = document.getElementById('passwordConfirm');

        // ì „ì²´ ë™ì˜ ì²´í¬ë°•ìŠ¤ ë¡œì§
        if (agreeAll) {
            agreeAll.addEventListener('change', function() {
                // í•„ìˆ˜ ë° ì„ íƒ ì•½ê´€ ì „ì²´ ì„ íƒ/í•´ì œ
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });
        }
        
        nextButton.addEventListener('click', function(e) {
            e.preventDefault(); 
            
            if (step1.classList.contains('active')) {
                // 1ë‹¨ê³„ (ì•½ê´€ ë™ì˜) -> 2ë‹¨ê³„ (ê¸°ë³¸ ì •ë³´)
                let allRequiredAgreed = true;
                requiredAgrees.forEach(checkbox => { if (!checkbox.checked) allRequiredAgreed = false; });
                
                if (allRequiredAgreed) {
                    step1.classList.remove('active');
                    step2.classList.add('active');
                    step1Indicator.classList.remove('active');
                    step2Indicator.classList.add('active');
                    nextButton.textContent = 'ë‹¤ìŒ';
                    window.scrollTo(0, 0); // ìŠ¤í¬ë¡¤ ì´ˆê¸°í™”
                } else { 
                    alert('í•„ìˆ˜ ì•½ê´€ì— ëª¨ë‘ ë™ì˜í•´ì•¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'); 
                }
            
            } else if (step2.classList.contains('active')) {
                // 2ë‹¨ê³„ (ê¸°ë³¸ ì •ë³´) -> 2-2ë‹¨ê³„ (ì¶”ê°€ ì •ë³´)
                
                // **í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬**
                if (!usernameInput.checkValidity()) {
                    alert('ì•„ì´ë””ëŠ” 5ì ì´ìƒì˜ ì˜ë¬¸, ìˆ«ì ì¡°í•©ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    usernameInput.focus();
                    return;
                }

                if (passwordInput.value.length < 8) {
                    alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    passwordInput.focus();
                    return;
                }

                if (passwordInput.value !== passwordConfirmInput.value) {
                    alert('ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    passwordConfirmInput.focus();
                    return; 
                }
                
                // ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼ ì‹œ
                step2.classList.remove('active');
                step2_2.classList.add('active');
                nextButton.textContent = 'ê°€ì… ì™„ë£Œ'; 
                window.scrollTo(0, 0); // ìŠ¤í¬ë¡¤ ì´ˆê¸°í™”

            } else if (step2_2.classList.contains('active')) {
                // 2-2ë‹¨ê³„ (ì¶”ê°€ ì •ë³´) -> 3ë‹¨ê³„ (ê°€ì… ì™„ë£Œ)
                
                // ìµœì¢… ì…ë ¥ í•„ë“œ ê²€ì‚¬ (required ì†ì„± ê²€ì‚¬)
                if (!signupForm.checkValidity()) {
                    // ìœ íš¨ì„± ê²€ì‚¬ì— ì‹¤íŒ¨í•˜ë©´ ë¸Œë¼ìš°ì € ê¸°ë³¸ ê²½ê³ ë¥¼ í‘œì‹œ
                    signupForm.reportValidity();
                    return;
                }

                // ë²„íŠ¼ íƒ€ì…ì„ submitìœ¼ë¡œ ë³€ê²½í•˜ê³  í¼ ì „ì†¡
                // Flaskì˜ @app.route('/signup', methods=['POST'])ë¥¼ í˜¸ì¶œ
                nextButton.type = 'submit'; 
                signupForm.submit();
                
                // **ì°¸ê³ : Flaskê°€ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë˜ë¯€ë¡œ,**
                // **ì•„ë˜ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì „í™˜ ë¡œì§ì€ ë³´í†µ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
                
                /*
                step2_2.classList.remove('active');
                step3.classList.add('active');
                
                step2Indicator.classList.remove('active');
                step3Indicator.classList.add('active');
                
                nextButton.textContent = 'ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ'; 
                nextButton.type = 'button'; 
                window.scrollTo(0, 0); 
                */

            } else if (step3.classList.contains('active')) {
                // 3ë‹¨ê³„ (ê°€ì… ì™„ë£Œ) -> ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                // Flaskì˜ login ë¼ìš°íŠ¸ë¡œ ì´ë™
                window.location.href = "{{ url_for('login_form') }}"; 
            }
        });
    });
</script>

</body>
</html>
